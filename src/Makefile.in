# Author: Assen Totin <assen.totin@gmail.com>
#
# This software is released under GNU General Public License.
# See the LICENSE file for details or visit http://www.gnu.org/copyleft/gpl.html 
# for details.

CC = @MAKEFILE_CC@
CFLAGS = -c -O2

BINDIR = @BINDIR@ 
LIBEXECDIR = @LIBEXECDIR@
PIXMAPDIR = @PIXMAPDIR@
ICONSDIR = @ICONSDIR@
DATAROOTDIR = @DATAROOTDIR@

INCLUDES=`pkg-config --cflags-only-I @LIBMATEPANELAPPLET@ libmate-2.0`
LIBS=`pkg-config --libs @LIBMATEPANELAPPLET@ libmate-2.0` -lX11

TARGET = lockkeys_applet

OBJS_MAIN = main.o

all: $(TARGET)

clean:
	rm -f *.o $(TARGET)

distclean:
	make clean
	rm -f Makefile
	rm -f org.mate.applets.LockkeysApplet.mate-panel-applet
	rm -f org.mate.panel.applet.LockkeysApplet.service

maintainer-clean:
	make distclean

install:
	test -z $(DESTDIR)$(LIBEXECDIR)/mate-panel || mkdir -p $(DESTDIR)$(LIBEXECDIR)/mate-panel
	cp -f $(TARGET) $(DESTDIR)$(LIBEXECDIR)/mate-panel
	test -z $(DESTDIR)$(PIXMAPDIR) || mkdir -p $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_lockkeys_capslock_off.xpm $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_lockkeys_capslock_on.xpm $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_lockkeys_numlock_off.xpm $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_lockkeys_numlock_on.xpm $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_lockkeys_scrolllock_off.xpm $(DESTDIR)$(PIXMAPDIR)
	cp -f images/applet_lockkeys_scrolllock_on.xpm $(DESTDIR)$(PIXMAPDIR)
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/16x16/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/16x16/apps/
	cp -f images/applet_lockkeys.16.png $(DESTDIR)$(ICONSDIR)/hicolor/16x16/apps/applet_lockkeys.png
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/22x22/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/22x22/apps/
	cp -f images/applet_lockkeys.22.png $(DESTDIR)$(ICONSDIR)/hicolor/22x22/apps/applet_lockkeys.png
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/24x24/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/24x24/apps/
	cp -f images/applet_lockkeys.24.png $(DESTDIR)$(ICONSDIR)/hicolor/24x24/apps/applet_lockkeys.png
	test -z $(DESTDIR)$(ICONSDIR)/hicolor/32x32/apps/ || mkdir -p $(DESTDIR)$(ICONSDIR)/hicolor/32x32/apps/
	cp -f images/applet_lockkeys.32.png $(DESTDIR)$(ICONSDIR)/hicolor/32x32/apps/applet_lockkeys.png
	gtk-update-icon-cache -f -t $(DESTDIR)$(ICONSDIR)/hicolor
	test -z $(DESTDIR)$(DATAROOTDIR)/mate-panel/applets/ || mkdir -p $(DESTDIR)$(DATAROOTDIR)/mate-panel/applets/
	cp -f org.mate.applets.LockkeysApplet.mate-panel-applet $(DESTDIR)$(DATAROOTDIR)/mate-panel/applets/
	test -z $(DESTDIR)$(DATAROOTDIR)/dbus-1/services/ || mkdir -p $(DESTDIR)$(DATAROOTDIR)/dbus-1/services/
	cp -f org.mate.panel.applet.LockkeysApplet.service $(DESTDIR)$(DATAROOTDIR)/dbus-1/services/
	test -z $(DESTDIR)$(DATAROOTDIR)/mate-2.0/ui/ || mkdir -p $(DESTDIR)$(DATAROOTDIR)/mate-2.0/ui/
	cp -f lockkeys-applet-menu.xml $(DESTDIR)$(DATAROOTDIR)/mate-2.0/ui/
	cp -f org.mate.panel.applet.LockkeysApplet.gschema.xml $(DESTDIR)$(DATAROOTDIR)/glib-2.0/schemas
	glib-compile-schemas $(DESTDIR)$(DATAROOTDIR)/glib-2.0/schemas 2>/dev/null

uninstall:
	rm -f $(TARGET) $(LIBEXECDIR)/mate-panel/$(TARGET)
	rm -f $(PIXMAPDIR)/applet_lockkeys_capslock_off.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_capslock_on.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_numlock_off.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_numlock_on.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_scrolllock_off.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_scrolllock_on.xpm
	rm -f $(ICONSDIR)/hicolor/16x16/apps/applet_lockkeys.png
	rm -f $(ICONSDIR)/hicolor/22x22/apps/applet_lockkeys.png
	rm -f $(ICONSDIR)/hicolor/24x24/apps/applet_lockkeys.png
	rm -f $(ICONSDIR)/hicolor/32x32/apps/applet_lockkeys.png
	gtk-update-icon-cache -f -t $(ICONSDIR)/hicolor
	rm -f $(DATAROOTDIR)/mate-panel/applets/org.mate.applets.LockkeysApplet.mate-panel-applet
	rm -f $(DATAROOTDIR)/dbus-1/services/org.mate.panel.applet.LockkeysApplet.service
	rm -f $(DATAROOTDIR)/mate-2.0/ui/lockkeys-applet-menu.xml
	rm -f $(DATAROOTDIR)/glib-2.0/schemas/org.mate.panel.applet.LockkeysApplet.gschema.xml

$(TARGET): main.c $(SRC_BACKEND)
	$(CC) $(CFLAGS) $(INCLUDES) main.c
	$(CC) -o $@ $(LIBS) $(OBJS_MAIN) 

