# Author: Assen Totin <assen.totin@gmail.com>
#
# This software is released under GNU General Public License.
# See the LICENSE file for details or visit http://www.gnu.org/copyleft/gpl.html 
# for details.

CC = @MAKEFILE_CC@
CFLAGS = -c -O2

BINDIR = @BINDIR@ 
LIBEXECDIR = @LIBEXECDIR@
PIXMAPDIR = @PIXMAPDIR@
ICONSDIR = @ICONSDIR@
DATAROOTDIR = @DATAROOTDIR@

INCLUDES=`pkg-config --cflags-only-I libmatepanelapplet-3.0 libmate-2.0`
LIBS=`pkg-config --libs libmatepanelapplet-3.0 libmate-2.0` -lX11

TARGET = lockkeys_applet

OBJS_MAIN = main.o

all: $(TARGET)

clean:
	rm -f *.o $(TARGET)

distclean:
	make clean
	rm -f Makefile
	rm -f org.mate.applets.LockkeysApplet.mate-panel-applet
	rm -f org.mate.panel.applet.LockkeysApplet.service

maintainer-clean:
	make distclean

install:
	test -z $(LIBEXECDIR)/mate-panel || mkdir -p $(LIBEXECDIR)/mate-panel
	cp -f $(TARGET) $(LIBEXECDIR)/mate-panel
	test -z $(PIXMAPDIR) || mkdir -p $(PIXMAPDIR)
	cp -f images/applet_lockkeys_capslock_off.xpm $(PIXMAPDIR)
	cp -f images/applet_lockkeys_capslock_on.xpm $(PIXMAPDIR)
	cp -f images/applet_lockkeys_numlock_off.xpm $(PIXMAPDIR)
	cp -f images/applet_lockkeys_numlock_on.xpm $(PIXMAPDIR)
	cp -f images/applet_lockkeys_scrolllock_off.xpm $(PIXMAPDIR)
	cp -f images/applet_lockkeys_scrolllock_on.xpm $(PIXMAPDIR)
	test -z $(ICONSDIR)/hicolor/16x16/apps/ || mkdir -p $(ICONSDIR)/hicolor/16x16/apps/
	cp -f images/applet_lockkeys.16.png $(ICONSDIR)/hicolor/16x16/apps/applet_lockkeys.png
	test -z $(ICONSDIR)/hicolor/22x22/apps/ || mkdir -p $(ICONSDIR)/hicolor/22x22/apps/
	cp -f images/applet_lockkeys.22.png $(ICONSDIR)/hicolor/22x22/apps/applet_lockkeys.png
	test -z $(ICONSDIR)/hicolor/24x24/apps/ || mkdir -p $(ICONSDIR)/hicolor/24x24/apps/
	cp -f images/applet_lockkeys.24.png $(ICONSDIR)/hicolor/24x24/apps/applet_lockkeys.png
	test -z $(ICONSDIR)/hicolor/32x32/apps/ || mkdir -p $(ICONSDIR)/hicolor/32x32/apps/
	cp -f images/applet_lockkeys.32.png $(ICONSDIR)/hicolor/32x32/apps/applet_lockkeys.png
	gtk-update-icon-cache -f -t $(ICONSDIR)/hicolor
	test -z $(DATAROOTDIR)/mate-panel/applets/ || mkdir -p $(DATAROOTDIR)/mate-panel/applets/
	cp -f org.mate.applets.LockkeysApplet.mate-panel-applet $(DATAROOTDIR)/mate-panel/applets/
	test -z $(DATAROOTDIR)/dbus-1/services/ || mkdir -p $(DATAROOTDIR)/dbus-1/services/
	cp -f org.mate.panel.applet.LockkeysApplet.service $(DATAROOTDIR)/dbus-1/services/

uninstall:
	rm -f $(TARGET) $(LIBEXECDIR)/mate-panel/$(TARGET)
	rm -f $(PIXMAPDIR)/applet_lockkeys_capslock_off.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_capslock_on.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_numlock_off.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_numlock_on.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_scrolllock_off.xpm
	rm -f $(PIXMAPDIR)/applet_lockkeys_scrolllock_on.xpm
	rm -f $(ICONSDIR)/hicolor/16x16/apps/applet_lockkeys.png
	rm -f $(ICONSDIR)/hicolor/22x22/apps/applet_lockkeys.png
	rm -f $(ICONSDIR)/hicolor/24x24/apps/applet_lockkeys.png
	rm -f $(ICONSDIR)/hicolor/32x32/apps/applet_lockkeys.png
	gtk-update-icon-cache -f -t $(ICONSDIR)/hicolor
	rm -f $(DATAROOTDIR)/mate-panel/applets/org.mate.applets.LockkeysApplet.mate-panel-applet
	rm -f $(DATAROOTDIR)/dbus-1/services/org.mate.panel.applet.LockkeysApplet.service

$(TARGET): main.c $(SRC_BACKEND)
	$(CC) $(CFLAGS) $(INCLUDES) main.c
	$(CC) -o $@ $(LIBS) $(OBJS_MAIN) 

